# 计算机网络-自顶而下
## 计算机网络与因特网

### 基本概念
因特网定义：
- 从因特网的基本硬件和软件组件描述
- 为分布式应用提供服务的联网基础设置来描述

**主机(端系统)**：与因特网连接的设备，包括客户PC和服务器\
**分组(package)**：当一台端系统要向另一台端系统发送数据时，发送端系统将数据分段，并为每段加上首部字节。形成的信息包用计算机网络的术语称为分组。\
**分组交换机(packet switch)**: 常见的类型有路由器(router)、链路层交换机(link-layer switch)\
**因特网服务提供商(Internet Service Provider, ISP)**：自身就是一个由多台分组交换机和多段通信链路组成的网络。
> 包括网线、住宅ISP、公司ISP、机场及公共场所提供WiFi接入的ISP

协议：定义了两个或多个通信实体之间交换的报文的格式和顺序，以及发送或接收一条报文或其他事件所采取的动作。
> 典型的陌生人之间的交互，可以用"您好？" 来发起一段对话，其实就是人之间交互的一个协议

带宽：连接期间链路为每条连接专用一个频段，该频段的宽度为带宽
### 接入网

![image](https://gitee.com/rbmon/file-storage/raw/main/learning-note/other/networkbook/connetNet.png)

**家庭接入**：数字用户线(Digital Subscriber Line, DSL)和电缆
> 住户从提供本地电话接入的电话公司获得DSL因特网接入。当使用DSL时，用户的本地电话公司是它的ISP。

家庭电话线同时承载了数据和传统的电话信号，他们用不同的频率进行编码，使得单根DSL线路像是有3跟独立线路，因此电话呼叫和互联网连接能够同时共享DSL链路。
- 高速下行信道，位于50kHz到1MHz频段
- 中速下行信道，位于4kHz到50kHz频段
- 普通的双线电话信道，位于0到4kHz频段

**光纤到户(FTTH)**：有源光纤网络(AON)和无源光纤网络(PON)\
**企业和家庭接入**：以太网和WiFi\
**广域无线接入**：3G和LTE

### 物理媒体
物理媒体分成两种类型：导引型媒体和非导引型媒体
- 导引型：电波沿着固体媒体前进，如光缆、双绞铜线、同轴电缆
- 非导引型：电波在空气或外层空间中传播，如无线局域网或数字卫星频道

### 网络核心
通过网络链路和交换机移动数据的两个基本方法：电路交换(circuit switching)和分组交换(package switching)

分组交换的性能优于电路交换的性能：
1. 分组交换提供了更好的带宽共享。电路交换不考虑需求，而是预先分配传输链路使用，使得**已分配而并不需要的链路时间**并未被利用。分组交换按需分配链路使用。
2. 分组交换的实现比电路交换更简单、更有效，实现成本更低。
#### 分组交换
分组交换：从源端系统向目的地端系统发送一个报文，源将长报文划分为较小的数据块。在源和目的地之间，每个分组都通过通信链路和分组交换机传输。

![image](https://gitee.com/rbmon/file-storage/raw/main/learning-note/other/networkbook/packetswitch.png)

**存储转发传输**：在交换机能够开始向输出链路传输该分组的第一个比特之前，必须接收到整组。

每台分组交换机有多条链路与之相连，对于每条相连的链路，该分组交换机具有一个输出缓存(输出队列)，用于存储路由器准备发往该链路的分组。
> 排队时延：链路正忙于传输其他分组，其后到达的分组必须等待。\
> 分组丢失：到达的分组发现缓存已经被其他分组充满。

#### 电路交换
电路交换中，在端系统间通信会话期间，预留了端系统间沿路径通信所需要的资源(缓存、链路传输速率)

![image](https://gitee.com/rbmon/file-storage/raw/main/learning-note/other/networkbook/circuitswitch.png)

电路交换网络中的复用：\
**频分复用**(Frequency-Division Multiplexing, FDM)：链路的频率域被划分为多个频段。\
**时分复用**(Time-Division Multiplexing, TDM)：一条TDM链路，时间被划分为固定期间的帧，并且每个帧又被划分为固定数量的时隙。

![image](https://gitee.com/rbmon/file-storage/raw/main/learning-note/other/networkbook/fdm-tdm.png)

#### 网络的网络
网络结构1：单一的全球传输ISP互联所有接入ISP。\
网络结构2：多个全球传输ISP互联所有接入ISP。\
网络结构3：多层的ISP结构，多个竞争的全球传输ISP、每个区域多个竞争的ISP(市级ISP、省级ISP、国家级ISP)并与上层区域连接。第一层ISP不向任何人付费，下层ISP向上层付费。\
网络结构4：在结构3基础上增加存在点(Point of Presence,PoP)、多宿、对等和因特网交换点。有接入ISP、区域ISP、PoP、多宿、对等和IXP组成。\
网络结构5：在结构4顶部增加内容提供商网络(content provider network)。内容服务商如Google，构建自己的网络与底层ISP对等(无结算)，对于较高层ISP可以通过IXP与其连接，减少其向顶层ISP支付的费用。

相关概念：
- 存在点(Point of Presence,PoP)：存在于登记结构的所有层次，但底层(接入ISP)等级除外。？？
- 多宿(multi-home)：任何一个ISP可以与两个或者多个提供商ISP连接。保证其中一个ISP故障，也可以通过其他ISP保障服务。
- 对等(peer)：位于相同等级结构层次的邻近一对ISP对等，而不是通过上游的ISP传输，节省通信流量。对等表示两个对等ISP之间无需进行流量结算。
- 因特网交换点(Internet Exchange Point, IXP)：IXP是一个汇总点，多个ISP能够在这里一起对等。

![image](https://gitee.com/rbmon/file-storage/raw/main/learning-note/other/networkbook/isbnetwork.png)

#### 分组交换中的时延、丢包和吞吐量
节点总时延 = 节点处理时延 + 排队时延 + 传输时延 + 传播时延
- 处理时延：检查分组首部和决定将该分组导向何处所需要的时间、检查比特级别的差错。
- 排队时延：分组在链路上等待传输。时间取决于先到达正在排队等待向链路传输的分组数量。
- 传输时延：将所有分组的比特推向链路所需要的时间。即推出分组所需要的时间，是分组长度和链路传输速率的函数，与两路由器的距离无关。
- 传播时延：从链路的起点到路由器B传播所需要的时间。

排队时延与丢包：一条链路钱的队列只有有限容量，随着流量强度接近1，到达的分组发现队列已满就会**丢弃**该分组，即该分组将丢失。

### 协议分层
5层因特网协议栈：
1. 应用层：HTTP、SMTP、FTP。位于应用层的信息分组称为报文(message)。
2. 运输层：TCP、UDP。因特网的运输层在应用程序端之间传送应用层报文。运输层的分组称为报文段(segment)
3. 网络层：IP。负责将数据报(datagram)的网络层分组从一台主机转移到另一台主机。
4. 链路层：为了将分组从一个节点移动到下一饿节点，网络层必须依靠链路层的服务。链路层的服务取决于应用于该链路的特定链路层协议，如可靠传递的协议(不同于TCP协议)。链路层的分组称为帧(frame)
5. 物理层：物理层的任务是将链路的帧中的一个个比特(bit)从一个节点移动到下一个节点。协议与链路相关，且进一步与传输媒体相关。

封装过程：
1. 发送主机端，一个**应用层报文**(application-layer message)被传输给运输层。
2. 运输层收取到报文并附上附加信息(运输层首部信息)，该报文将被**接收端**的运输层使用。应用层报文和运输层首部信息构成**运输层报文段(transport-layer segment)**，传输给网络层。
    > 运输层报文段：附加的信息包括应用层报文、差错检测位信息(接收方判断报文是否改变)
3. 网络层接收到报文段，增加了如源和目的端系统地址等网络层首部信息，生成**网络层数据报(network-layer datagram)**，发送链路层。
4. 链路层接收到数据报，增加链路层首部信息并生成**链路层帧(link-layer frame)**

在每一层一个分组都有两种类型的字段：首部字段和**有效荷载字段(payload field)**

![image](https://gitee.com/rbmon/file-storage/raw/main/learning-note/other/networkbook/layers.png)

### 网络攻击
- 病毒攻击：通过软件文件感染设备
- 分组嗅探器：如WiFi连接放置一台被动的接收器，接收器就能得到每个分组的副本。即网络传输的所有信息。
- IP哄骗
- 拒绝服务攻击(Denial-of-Service attack, DoS attack)

DoS攻击分为以下三类：
1. 弱点攻击：利用主机上软件或系统的漏洞，进行攻击，造成服务器停止运行或主机崩溃。
2. 带宽洪泛：向目标主机发送大量的分组，使目标的接入链路变得拥塞，合法的分组无法到达服务器。
3. 连接洪泛：攻击者在目标主机中创建大量的半开或全开TCP连接。该主机因这些伪造的连接，而无法接受合法的连接。

## 应用层
Web应用程序的两种应用程序体系结构：
1. CS架构。用户主机 - Web服务器主机的服务器程序，如搜索服务、facebook、instagram
2. 对等体系结构(P2P)。P2P文件共享系统。参与文件共享的社区中，每台主机中都有一个程序。如BitTorrent、迅雷

![image](https://gitee.com/rbmon/file-storage/raw/main/learning-note/other/networkbook/application-architure.png)


### 可供应用程序使用的运输服务
应用程序服务的对于运输协议要求可分为四大类：可靠数据传输、吞吐量、定时和安全性

**可靠数据传输**：一个协议确保由应用程序一端发送的数据正确、完全地交付给应用程序的另一端。
> 多媒体应用、交谈式音频/视频，能够承受一定量的数据丢失，为容忍丢失的应用。

**吞吐量**：指发送进程能够向接收进程交付比特的速率。即运输层能够以某种特定的速率提供确保的可用吞吐量。
> **带宽敏感的应用**：具有吞吐量要求的应用程序。如一些多媒体应用，保证用户使用体验，必须保证一定的带宽速率\
> **弹性应用**：能够根据当时可用的带宽或多或少利用可供使用的吞吐量。如电子邮件、文件传输

**定时(确定的时延)**：如发送方注入到套接字中的每个比特到达接收方的套接字不迟于100ms。相关需求的应用程序如因特网电话、多方游戏等

**安全性**：运输协议能够为应用程序提供一种或多种安全性服务。

### TCP服务
TCP服务包括面向连接服务和可靠数据传输服务。另外TCP还具有拥塞控制机制

- 面向连接服务：应用层报文开始流动前，先建立连接。该连接是**全双工**的，即连接双方的进程可以在此连接上同时进行报文收发。
- 可靠的数据传输服务：通信进程能够依靠TCP，**无差错、按适当顺序交付**所有发送的字节。
- 拥塞控制机制：当发送方和接收方之间的网络出现拥塞时，TCP的拥塞控制机制会抑制发送进程。